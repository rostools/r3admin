---
title: "Intermediate course admin tasks"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  eval = FALSE,
  collapse = TRUE,
  comment = "#>"
)
library(tidyverse)
library(ghclass)
devtools::load_all()
course_date <- "2023-06-06"
# course_date <- "2023-06-19"
course_type <- "r-cubed-intermediate"
```

```{r, eval=FALSE}
# Set GitHub PAT
# gitcreds::gitcreds_set()
ghclass::github_set_token(gitcreds::gitcreds_get(use_cache = FALSE)$password)
```

## Pre-course admin tasks

```{r, eval=FALSE}
admin_create_planning_issue(course_type, course_date, host = "github")
```

### Fetch (and save) pre-survey responses

First thing, need to get the precourse results.

```{r}
# TODO: How to get these authenticated? Run first and then build vignette?
googledrive::drive_auth()
googlesheets4::gs4_auth()
precourse <- fetch_precourse_inter() %>%
  filter(course_version == max(course_version)) %>% 
  filter(!str_detect(email, "\\.se$"))
```

### Who didn't finish survey

Check those who didn't finish the survey yet. Do need the official list
to compare with, which can be deleted after the course.

```{r, eval=FALSE}
participants <- check_who_not_finish_survey(
  precourse,
  readr::read_csv(here::here("_ignore/official-participant-list.csv"))
)
nrow(participants)
View(participants)
```

Then need to send a reminder email to those who didn't complete the
survey or tasks yet.

```{r, eval=FALSE}
copy_emails_for_reminder(participants)
copy_reminder_email_text()
```

### Basic setup checks

Quickly check whether everyone has their setups done correctly.

```{r, results='asis'}
cat(check_setup(precourse))
```

```{r, results='asis'}
cat(check_project_setup(precourse))
```

### Who has problems

List those who have problems and print their setups.

```{r, results='asis'}
problems <- precourse %>%
  check_precourse_problems()
```

#### Description of the problems

```{r, results='asis'}
problems %>%
  check_problem_description() %>%
  cat()
```

#### Setup of those with problems

```{r, results='asis'}
problems %>%
  check_setup() %>%
  cat()
```

#### Copy names to address in first day

Copy the names of those who have problems so I can paste it to something
like Telegram so I know who to seek out on the first day.

```{r, eval=FALSE}
problems %>%
  dplyr::pull(full_name) %>%
  copy_names_with_problems()
```

### Create group names

Create some fun group names for the course. There is some manual action
here to select the names I think are interesting or funky. Make groups
with about 4 people per group.

```{r}
set.seed(3245)
group_names <- create_group_names()

# ceiling(nrow(precourse) / 4)
19 / 4
group_names
group_names_final <- group_names[c(
  20, 34, 22, 58, 2
)]
group_names_final
```

Create PDF files of the group names, so we can print the files before
the first day and put one of them on each table.

```{r, eval=FALSE, results='hide'}
group_names_final %>%
  group_names_to_one_pdf()
```

Then to create some HTML files (that I will print to file manually for
now) of strips of group names to cut out of on a paper.

```{r, eval=FALSE}
group_names_final %>%
  group_names_as_strips_html(number_participants = 19)
```

### Invite to Slack group

```{r, eval=FALSE}
copy_emails_for_slack_invite(precourse$email)
```

## Post course admin

Need to run these inside the project.

```{r, eval=FALSE}
```
